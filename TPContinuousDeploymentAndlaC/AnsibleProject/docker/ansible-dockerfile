FROM ubuntu:latest

# Éviter les invites dans apt
ENV DEBIAN_FRONTEND=noninteractive

# Installer OpenSSH Server
RUN apt-get update && \
    apt-get install -y openssh-server && \
    mkdir /var/run/sshd

# Installer Ansible
RUN apt-get update && \
    apt-get install -y software-properties-common && \
    add-apt-repository --yes --update ppa:ansible/ansible && \
    apt-get install -y ansible

# Ajouter la clé publique à authorized_keys
COPY id_rsa.pub /root/.ssh/authorized_keys

# Changer les permissions sur la clé privée
COPY id_rsa /root/.ssh/id_rsa
RUN chmod 600 /root/.ssh/id_rsa

# Nettoyer pour réduire la taille de l'image
RUN apt-get clean && \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

CMD ["/usr/sbin/sshd", "-D"]

